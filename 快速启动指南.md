# 🚀 AIPPOF 快速启动指南

## 📋 环境要求

- **Python**: 3.8+
- **Node.js**: 16+ (LTS版本)
- **npm**: 7+
- **浏览器**: Chrome/Edge/Firefox (支持ES6+)

---

## ⚡ 快速启动 (2分钟)

### 1️⃣ 启动后端服务器

```powershell
# 进入后端目录
cd "c:\Users\10046\Desktop\python代码测试\code1\final-new\08_AIPPOF网页应用\backend"

# 安装Python依赖(首次运行)
pip install flask flask-cors numpy scipy pandas python-dotenv

# 启动Flask服务器
python main.py
```

**预期输出**:
```
* Running on http://127.0.0.1:8000
* Debugger PIN: 954-431-443
```

### 2️⃣ 启动前端开发服务器

**新开一个PowerShell终端**:

```powershell
# 添加Node.js到PATH(如果需要)
$env:Path = "C:\Program Files\nodejs;" + $env:Path

# 进入项目根目录
cd "c:\Users\10046\Desktop\python代码测试\code1\final-new\08_AIPPOF网页应用"

# 安装依赖(首次运行，需要3-5分钟)
npm install

# 启动Vite开发服务器
npm run dev
```

**预期输出**:
```
VITE v5.4.21  ready in 393 ms
➜  Local:   http://localhost:5173/
```

### 3️⃣ 访问应用

**在浏览器中打开**: http://localhost:5173

---

## 🧪 测试API (可选)

### 方式1: 网页测试界面

在浏览器中打开:
```
c:\Users\10046\Desktop\python代码测试\code1\final-new\08_AIPPOF网页应用\backend\test_api.html
```

点击各个按钮测试12个API端点。

### 方式2: Python测试脚本

```powershell
cd backend
python test_new_apis.py
```

**预期输出**: 显示所有12个API的测试结果。

---

## 📱 使用流程

### 路径A - 新参与者预测

1. 在欢迎页选择 **"新参与者 - 方案预测"**
2. 填写个人信息:
   - 年龄: 20-59岁
   - 年薪: ¥30,000 - ¥2,000,000
   - 行业: IT/金融/制造业等9个选项
   - 职级: 初级/中级/高级/管理
3. 提交后查看AI报告:
   - 当前T2节税率
   - AI预测工资增长率
   - 推荐缴费额
   - 全生命周期可视化Dashboard
   - A/B测试Nudge话术
4. 选择"采纳AI建议"或"维持现状"

### 路径B - 已参与者诊断

1. 在欢迎页选择 **"已参与者 - 方案诊断"**
2. 选择数据输入方式:
   - 方式1: 授权API接入(开发中)
   - 方式2: 上传截图OCR识别(开发中)
   - 方式3: 手动录入历史数据 ✅
3. 输入3年历史:
   ```
   2022年: 年薪¥120,000, 缴费¥8,000
   2023年: 年薪¥135,000, 缴费¥10,000
   2024年: 年薪¥150,000, 缴费¥12,000
   ```
4. 查看诊断报告:
   - 累积加权平均T2
   - 效率评分(0-100分)
   - 历史缴费趋势图
   - 优化建议

---

## 🎨 页面预览

### 1. Welcome欢迎页
- 深紫到深蓝渐变背景
- 两个玻璃态卡片按钮
- SVG图标动画

### 2. PathA输入表单
- 4个输入字段
- 下拉选择器(行业/职级)
- 实时验证提示

### 3. AI预测报告
- 3大核心指标卡片
- AI决策三大理由
- 动态对比表格
- A/B测试Nudge话术
- **全周期可视化Dashboard** ⭐ 新增
  - 账户余额增长曲线
  - 缴费期收益分解
  - 领取期现金流分析
  - 缴费策略对比

### 4. 全周期Dashboard组件
- **4个ECharts图表**:
  1. 📊 账户余额增长曲线(50年)
  2. 💰 缴费期收益构成(堆叠+折线)
  3. 📈 领取期现金流分析
  4. 🎯 缴费策略对比(¥4k/¥8k/¥12k)
- **数据汇总卡片**: 8项关键指标
- **导出按钮**: PDF和Excel(开发中)

---

## 🔧 API端点一览

### 核心计算(6个)

| 端点 | 功能 | 示例参数 |
|-----|------|---------|
| `/api/predict-wage-growth` | 工资增长率预测 | age=30, salary=150k, industry=it |
| `/api/calculate-t2` | T2节税率计算 | age=30, salary=150k, g=3.9% |
| `/api/calculate-t3` | T3领取税率 | t2=1.4%, salary=150k |
| `/api/optimize-contribution` | 推荐缴费额 | age=30, salary=150k, t2=1.4% |
| `/api/calculate-npv` | NPV净现值 | contribution=9500, t2=1.4%, t3=1.2% |
| `/api/diagnose-history` | 历史诊断 | historyData=[...], age=30 |

### 高级分析(6个)

| 端点 | 功能 | 输出 |
|-----|------|------|
| `/api/lifecycle-data` | 全周期数据生成 | 50年×365天详细数据 |
| `/api/comparison-scenarios` | 缴费额对比 | 3种方案NPV对比 |
| `/api/risk-assessment` | T3风险评估 | 风险等级+退出概率 |
| `/api/optimal-cap` | 最优上限 | 避险推荐缴费额 |
| `/api/fiscal-analysis` | 财政分析 | 政府成本vs收入 |
| `/api/fiscal-optimize` | 财政优化 | 平衡缴费额 |

---

## 🐛 常见问题

### Q1: 前端启动失败，提示"npm不是命令"

**解决方案**:
```powershell
# 临时添加Node.js到PATH
$env:Path = "C:\Program Files\nodejs;" + $env:Path

# 或永久添加到系统环境变量
# 系统设置 > 高级 > 环境变量 > Path > 编辑
# 添加: C:\Program Files\nodejs
```

### Q2: 后端启动失败，提示"模块未找到"

**解决方案**:
```powershell
# 安装缺失的Python包
pip install flask flask-cors numpy scipy pandas python-dotenv requests

# 检查Python版本
python --version  # 需要3.8+
```

### Q3: API测试返回CORS错误

**解决方案**: 确保后端Flask服务器已启动且`CORS(app)`已配置。

### Q4: ECharts图表不显示

**解决方案**: 
1. 检查浏览器控制台是否有错误
2. 确认后端API返回数据正确
3. 刷新页面或清除缓存

### Q5: 页面样式错乱

**解决方案**:
```powershell
# 重新安装前端依赖
rm -rf node_modules
npm install

# 清除Vite缓存
rm -rf .vite
npm run dev
```

---

## 📊 性能优化建议

### 开发环境
- **后端**: Debug模式，自动重载
- **前端**: HMR热更新，实时预览
- **浏览器**: 使用Chrome DevTools监控性能

### 生产环境(未来)
- **后端**: Gunicorn + 4 workers
- **前端**: `npm run build` 生成静态文件
- **部署**: Nginx反向代理
- **数据库**: PostgreSQL持久化存储

---

## 🔐 安全注意事项

### 当前版本(开发环境)
- ⚠️ Flask Debug模式已开启
- ⚠️ 无用户认证
- ⚠️ 无数据加密
- ⚠️ CORS允许所有来源

### 生产部署时需要
- [ ] 关闭Debug模式
- [ ] 添加JWT用户认证
- [ ] 启用HTTPS (SSL证书)
- [ ] 限制CORS来源
- [ ] 添加请求频率限制
- [ ] 敏感数据加密存储

---

## 📞 技术支持

### 查看日志
- **后端日志**: 终端输出
- **前端日志**: 浏览器控制台(F12)
- **API调试**: 使用test_api.html或Postman

### 重启服务

**后端**:
```powershell
# Ctrl+C 停止
python main.py  # 重新启动
```

**前端**:
```powershell
# Ctrl+C 停止
npm run dev  # 重新启动
```

---

## 🎯 下一步

1. ✅ 确认两个服务都已启动
2. ✅ 打开 http://localhost:5173 测试完整流程
3. ✅ 使用test_api.html验证所有API
4. 📝 根据测试反馈优化功能
5. 🚀 准备用户测试和数据收集

---

**项目路径**: `c:\Users\10046\Desktop\python代码测试\code1\final-new\08_AIPPOF网页应用`  
**开发日期**: 2024-11-02  
**版本**: v0.2.0  

🎉 **祝您使用愉快！**
