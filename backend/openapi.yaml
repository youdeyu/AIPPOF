openapi: 3.0.3
info:
  title: AIPPOF API - ä¸ªäººå…»è€é‡‘ä¼˜åŒ–è®¡ç®—å¹³å°
  description: |
    AIPPOF (AI-Powered Individual Pension Optimization Framework) APIæ–‡æ¡£
    
    æœ¬APIæä¾›ä¸¤æ¡ä¸»è¦è·¯å¾„:
    - **PathA (æ–°å‚ä¸è€…)**: ä¸ºé¦–æ¬¡å‚ä¸è€…æä¾›ç¼´è´¹æ–¹æ¡ˆä¼˜åŒ–
    - **PathB (å·²å‚ä¸è€…)**: ä¸ºå·²æœ‰ç¼´è´¹å†å²çš„å‚ä¸è€…æä¾›è¯Šæ–­å’Œä¼˜åŒ–å»ºè®®
    
    æ ¸å¿ƒåŠŸèƒ½:
    - T2ç¨æ”¶ä¼˜æƒ è®¡ç®— (å…°æµ©å“¥å…¬å¼)
    - T3é¢†å–æœŸç¨ç‡è®¡ç®— (åŒé€»è¾‘å‡½æ•°)
    - ç²¾å‡†è¡¥è´´è®¡ç®— (ä¸¤æ¡£åŒ¹é…+å‰Šå‡æœºåˆ¶)
    - ç¼´è´¹ä¸Šé™è®¡ç®— (Formula 5-5æ··åˆåŠ¨æ€ä¸Šé™)
    - AIå·¥èµ„å¢é•¿é¢„æµ‹
    - NPVæ”¶ç›Šè®¡ç®—
    - å†å²ç¼´è´¹è¯Šæ–­
    - ä¸ªæ€§åŒ–ä¼˜åŒ–å»ºè®®
    
  version: 1.0.0
  contact:
    name: AIPPOF Development Team
    email: support@aippof.com
  license:
    name: MIT
    url: https://opensource.org/licenses/MIT

servers:
  - url: http://localhost:8000
    description: æœ¬åœ°å¼€å‘æœåŠ¡å™¨
  - url: https://api.aippof.com
    description: ç”Ÿäº§ç¯å¢ƒæœåŠ¡å™¨

tags:
  - name: PathA - æ–°å‚ä¸è€…
    description: é¦–æ¬¡å‚ä¸è€…çš„ç¼´è´¹æ–¹æ¡ˆä¼˜åŒ–API
  - name: PathB - å·²å‚ä¸è€…
    description: å·²æœ‰ç¼´è´¹å†å²çš„å‚ä¸è€…è¯Šæ–­å’Œä¼˜åŒ–API
  - name: æ ¸å¿ƒè®¡ç®—
    description: åº•å±‚è®¡ç®—API (T2/T3/è¡¥è´´/ä¸Šé™)
  - name: è¾…åŠ©å·¥å…·
    description: è¾…åŠ©è®¡ç®—å·¥å…·API

paths:
  /health:
    get:
      summary: å¥åº·æ£€æŸ¥
      description: æ£€æŸ¥APIæœåŠ¡æ˜¯å¦æ­£å¸¸è¿è¡Œ
      responses:
        '200':
          description: æœåŠ¡æ­£å¸¸
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: "healthy"
                  timestamp:
                    type: string
                    format: date-time

  # ==================== PathA API ====================
  
  /api/predict-wage-growth:
    post:
      tags:
        - PathA - æ–°å‚ä¸è€…
      summary: å·¥èµ„å¢é•¿ç‡é¢„æµ‹
      description: |
        ä½¿ç”¨AIå’Œè”ç½‘æœç´¢é¢„æµ‹æœªæ¥å·¥èµ„å¢é•¿ç‡
        
        é¢„æµ‹æ–¹æ³•:
        - åŸºç¡€é¢„æµ‹ (è¡Œä¸š+å²—ä½+å¹´é¾„+æ”¶å…¥å› å­)
        - AIæ·±åº¦æ€è€ƒ (å¯é€‰,éœ€è¦OPENAI_API_KEY)
        - è”ç½‘æœç´¢éªŒè¯ (å¯é€‰)
        
        æœ€ç»ˆé¢„æµ‹ = åŸºç¡€40% + AI40% + æœç´¢20%
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - age
                - annualSalary
                - industry
                - jobLevel
              properties:
                age:
                  type: integer
                  minimum: 18
                  maximum: 65
                  description: å½“å‰å¹´é¾„
                  example: 30
                annualSalary:
                  type: number
                  minimum: 0
                  description: å¹´è–ª (å…ƒ)
                  example: 150000
                industry:
                  type: string
                  enum: [it, finance, manufacturing, education, healthcare, other]
                  description: æ‰€å±è¡Œä¸š
                  example: "it"
                jobLevel:
                  type: string
                  enum: [entry, intermediate, senior, expert, management]
                  description: èŒçº§
                  example: "intermediate"
      responses:
        '200':
          description: é¢„æµ‹æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  predicted_growth_rate:
                    type: number
                    description: é¢„æµ‹å¢é•¿ç‡ (%)
                    example: 5.65
                  confidence:
                    type: number
                    description: ç½®ä¿¡åº¦ (0-1)
                    example: 0.85
                  industry_average:
                    type: number
                    description: è¡Œä¸šå¹³å‡å¢é•¿ç‡ (%)
                    example: 5.0
                  methodology:
                    type: string
                    description: é¢„æµ‹æ–¹æ³•
                    example: "base+ai+web"
                  factors:
                    type: object
                    properties:
                      base_growth:
                        type: number
                        example: 5.2
                      ai_adjusted_growth:
                        type: number
                        nullable: true
                        example: 6.1
                      web_search_growth:
                        type: number
                        nullable: true
                        example: 5.5
                  ai_insights:
                    type: array
                    items:
                      type: string
                    example: ["ITè¡Œä¸šæŒç»­é«˜å¢é•¿", "ä¸­çº§å²—ä½æ™‹å‡ç©ºé—´å¤§"]
        '400':
          description: å‚æ•°é”™è¯¯
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Error'

  /api/calculate-t2:
    post:
      tags:
        - æ ¸å¿ƒè®¡ç®—
      summary: T2ç¨æ”¶ä¼˜æƒ ç‡è®¡ç®—
      description: |
        ä½¿ç”¨å…°æµ©å“¥å…¬å¼è®¡ç®—T2ç¨æ”¶ä¼˜æƒ ç‡
        
        å…¬å¼: T2 = (å®é™…ç¨æ”¶èŠ‚çº¦) / 12000 * 100%
        
        è€ƒè™‘å› ç´ :
        - ç¼´è´¹å¹´é™ (60-å¹´é¾„)
        - å·¥èµ„å¢é•¿ç‡
        - è¾¹é™…ç¨ç‡
        - æŠ•èµ„å›æŠ¥ç‡ (1.75%)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - age
                - annualSalary
                - wageGrowthRate
              properties:
                age:
                  type: integer
                  minimum: 18
                  maximum: 59
                  example: 30
                annualSalary:
                  type: number
                  minimum: 0
                  example: 150000
                wageGrowthRate:
                  type: number
                  minimum: 0
                  maximum: 20
                  description: å·¥èµ„å¢é•¿ç‡ (%)
                  example: 4.5
      responses:
        '200':
          description: è®¡ç®—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  t2:
                    type: number
                    description: T2ç¨æ”¶ä¼˜æƒ ç‡ (%)
                    example: 10.0
                  t1:
                    type: number
                    description: è¾¹é™…ç¨ç‡ (%)
                    example: 20.0
                  n:
                    type: integer
                    description: ç¼´è´¹å¹´é™
                    example: 30
                  formula:
                    type: string
                    description: è®¡ç®—å…¬å¼
                    example: "T2 = 12000.00 / 12000 * 100% = 10.00%"
                  details:
                    type: object
                    properties:
                      contributionYears:
                        type: integer
                        example: 30
                      returnRate:
                        type: number
                        example: 1.75
                      wageGrowthRate:
                        type: number
                        example: 4.5
                      marginalTaxRate:
                        type: number
                        example: 20.0
                      taxSaving:
                        type: number
                        example: 12000.0

  /api/calculate-t3:
    post:
      tags:
        - æ ¸å¿ƒè®¡ç®—
      summary: T3é¢†å–æœŸç¨ç‡è®¡ç®—
      description: |
        ä½¿ç”¨åŒé€»è¾‘å‡½æ•°è®¡ç®—T3é¢†å–æœŸç¨ç‡
        
        å…¬å¼: T3 = f1(T2) + f2(æ”¶å…¥)
        - f1: T2æ•æ„Ÿé€»è¾‘å‡½æ•° (0-7%)
        - f2: æ”¶å…¥æ•æ„Ÿé€»è¾‘å‡½æ•° (0-7%)
        
        T3èŒƒå›´: 0-14%
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - t2
                - annualSalary
                - age
              properties:
                t2:
                  type: number
                  minimum: 0
                  maximum: 45
                  description: T2ç¨æ”¶ä¼˜æƒ ç‡ (%)
                  example: 10.0
                annualSalary:
                  type: number
                  minimum: 0
                  example: 150000
                age:
                  type: integer
                  minimum: 18
                  maximum: 65
                  example: 30
      responses:
        '200':
          description: è®¡ç®—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  t3:
                    type: number
                    description: T3é¢†å–æœŸç¨ç‡ (%)
                    example: 7.2
                  formula:
                    type: string
                    example: "T3 = f1(T2) + f2(Income) = 7.20%"
                  components:
                    type: object
                    properties:
                      t2_component:
                        type: number
                        example: 3.8
                      income_component:
                        type: number
                        example: 3.4

  /api/calculate-subsidy:
    post:
      tags:
        - æ ¸å¿ƒè®¡ç®—
      summary: ç²¾å‡†è¡¥è´´è®¡ç®—
      description: |
        è®¡ç®—æ”¿åºœç²¾å‡†è¡¥è´´é‡‘é¢
        
        æœºåˆ¶:
        - ä¸¤æ¡£åŒ¹é…: ä½æ”¶å…¥50%, ä¸­æ”¶å…¥30%
        - æ”¶å…¥å‰Šå‡: çº¿æ€§å‰Šå‡è‡³å½’é›¶ç‚¹
        
        **é‡è¦**: å¹´è–ªâ‰¥15ä¸‡, è¡¥è´´=0
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - annualSalary
                - contributionAmount
              properties:
                annualSalary:
                  type: number
                  minimum: 0
                  example: 60000
                contributionAmount:
                  type: number
                  minimum: 0
                  maximum: 12000
                  example: 5000
      responses:
        '200':
          description: è®¡ç®—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  subsidy:
                    type: number
                    description: è¡¥è´´é‡‘é¢ (å…ƒ)
                    example: 612.0
                  tier:
                    type: string
                    enum: [low_income, middle_income, high_income]
                    example: "low_income"
                  match_rate:
                    type: number
                    description: åŒ¹é…ç‡ (%)
                    example: 50.0
                  taper_factor:
                    type: number
                    description: å‰Šå‡ç³»æ•° (0-1)
                    example: 0.245

  /api/calculate-cap:
    post:
      tags:
        - æ ¸å¿ƒè®¡ç®—
      summary: ç¼´è´¹ä¸Šé™è®¡ç®—
      description: |
        ä½¿ç”¨Formula 5-5è®¡ç®—ç¼´è´¹ä¸Šé™
        
        ç­–ç•¥: min(åŠ¨æ€ä¸Šé™, å›ºå®šä¸Šé™12000)
        
        åŠ¨æ€ä¸Šé™ = f(å¹´è–ª, T2ç‡)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - annualSalary
                - t2Rate
              properties:
                annualSalary:
                  type: number
                  minimum: 0
                  example: 150000
                t2Rate:
                  type: number
                  minimum: 0
                  maximum: 45
                  example: 10.0
      responses:
        '200':
          description: è®¡ç®—æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  cap:
                    type: number
                    description: ç¼´è´¹ä¸Šé™ (å…ƒ)
                    example: 12000
                  strategy:
                    type: string
                    description: ä½¿ç”¨çš„ç­–ç•¥
                    example: "min_dynamic_vs_fixed"
                  details:
                    type: object
                    properties:
                      dynamic_cap:
                        type: number
                        example: 15000
                      fixed_cap:
                        type: number
                        example: 12000
                      selected_cap:
                        type: number
                        example: 12000

  /api/optimize-contribution:
    post:
      tags:
        - PathA - æ–°å‚ä¸è€…
      summary: ç¼´è´¹æ–¹æ¡ˆä¼˜åŒ–
      description: |
        ä¸ºæ–°å‚ä¸è€…ç”Ÿæˆ3æ¡£ç¼´è´¹æ–¹æ¡ˆ
        
        æ–¹æ¡ˆæ¡£ä½:
        - ä¿å®ˆå‹ (60%ä¸Šé™)
        - å‡è¡¡å‹ (80%ä¸Šé™) â­ æ¨è
        - æ¿€è¿›å‹ (100%ä¸Šé™)
        
        æ¯ä¸ªæ–¹æ¡ˆåŒ…å«: ç¼´è´¹é¢ã€T2ã€è¡¥è´´ã€NPV
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - age
                - annualSalary
                - wageGrowthRate
              properties:
                age:
                  type: integer
                  example: 30
                annualSalary:
                  type: number
                  example: 150000
                wageGrowthRate:
                  type: number
                  example: 4.5
      responses:
        '200':
          description: ä¼˜åŒ–æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  scenarios:
                    type: array
                    minItems: 3
                    maxItems: 3
                    items:
                      type: object
                      properties:
                        name:
                          type: string
                          example: "å‡è¡¡å‹"
                        contribution:
                          type: number
                          example: 12000
                        predictedT2:
                          type: number
                          example: 10.0
                        subsidy:
                          type: number
                          example: 0
                        npv:
                          type: number
                          example: 61961.12
                  t2:
                    type: number
                    example: 10.0
                  t3:
                    type: number
                    example: 7.2
                  cap:
                    type: number
                    example: 12000
                  subsidyTierInfo:
                    type: object

  # ==================== PathB API ====================
  
  /api/diagnose-history:
    post:
      tags:
        - PathB - å·²å‚ä¸è€…
      summary: å†å²ç¼´è´¹è¯Šæ–­
      description: |
        åˆ†æå†å²ç¼´è´¹æ•°æ®,ç”Ÿæˆè¯Šæ–­æŠ¥å‘Š
        
        è¾“å‡ºæŒ‡æ ‡:
        - æ•ˆç‡è¯„åˆ† (0-100åˆ†)
        - ç´¯ç§¯T2
        - ç´¯è®¡è¡¥è´´
        - é¢„æµ‹T3
        - å†å²è¯¦æƒ…
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - historyData
                - age
              properties:
                historyData:
                  type: array
                  minItems: 1
                  items:
                    type: object
                    required:
                      - year
                      - salary
                      - contribution
                    properties:
                      year:
                        type: integer
                        example: 2022
                      salary:
                        type: number
                        example: 120000
                      contribution:
                        type: number
                        example: 8000
                age:
                  type: integer
                  minimum: 18
                  maximum: 65
                  example: 35
      responses:
        '200':
          description: è¯Šæ–­æˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  efficiencyScore:
                    type: number
                    description: æ•ˆç‡è¯„åˆ† (0-100)
                    example: 75
                  cumulativeT2:
                    type: number
                    description: ç´¯ç§¯T2 (%)
                    example: 2.5
                  totalSubsidy:
                    type: number
                    description: ç´¯è®¡è¡¥è´´ (å…ƒ)
                    example: 1500
                  predictedT3:
                    type: number
                    description: é¢„æµ‹T3 (%)
                    example: 5.2
                  historicalDetails:
                    type: array
                    items:
                      type: object
                      properties:
                        year:
                          type: integer
                        t2:
                          type: number
                        subsidy:
                          type: number
                        efficiency:
                          type: number

  /api/ai-suggestions:
    post:
      tags:
        - PathB - å·²å‚ä¸è€…
      summary: AIä¸ªæ€§åŒ–å»ºè®®
      description: |
        åŸºäºè¯Šæ–­ç»“æœç”ŸæˆAIä¼˜åŒ–å»ºè®®
        
        å»ºè®®å†…å®¹:
        - ä¼˜åŒ–å»ºè®® (å«ä¼˜å…ˆçº§)
        - è¡ŒåŠ¨è®¡åˆ’
        - é£é™©è­¦ç¤º
        - é¢„æœŸæ”¶ç›Š
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentAge
              properties:
                diagnosisResult:
                  type: object
                  description: è¯Šæ–­ç»“æœ (å¯é€‰,å¦‚æœªæä¾›åˆ™ä»historyDataè®¡ç®—)
                historyData:
                  type: array
                  description: å†å²æ•°æ® (å¦‚æœªæä¾›diagnosisResultåˆ™å¿…å¡«)
                  items:
                    type: object
                currentAge:
                  type: integer
                  example: 35
      responses:
        '200':
          description: ç”ŸæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  priority:
                    type: string
                    enum: [low, medium, high]
                    example: "medium"
                  suggestions:
                    type: array
                    items:
                      type: object
                      properties:
                        type:
                          type: string
                          example: "optimize"
                        priority:
                          type: string
                          enum: [low, medium, high]
                          example: "medium"
                        icon:
                          type: string
                          example: "ğŸ“Š"
                        title:
                          type: string
                          example: "å¯è¿›ä¸€æ­¥ä¼˜åŒ–"
                        description:
                          type: string
                        action:
                          type: string
                  actionPlan:
                    type: object
                  riskWarnings:
                    type: array
                    items:
                      type: string
                  expectedBenefit:
                    type: object
                    properties:
                      annualGain:
                        type: number
                      lifetimeGain:
                        type: number
                      npvImprovement:
                        type: number

  /api/5tier-suggestions:
    post:
      tags:
        - PathB - å·²å‚ä¸è€…
      summary: äº”æ¡£ç¼´è´¹æ–¹æ¡ˆ
      description: |
        ç”Ÿæˆ5æ¡£ç¼´è´¹æ–¹æ¡ˆ,å«NPVå¯¹æ¯”
        
        æ¡£ä½:
        - ğŸ›¡ï¸ ä¿å®ˆå‹ (30%ä¸Šé™)
        - ğŸ“Š ç¨³å¥å‹ (50%ä¸Šé™)
        - âš–ï¸ å‡è¡¡å‹ (70%ä¸Šé™) â­ AIæ¨è
        - ğŸ“ˆ ç§¯æå‹ (85%ä¸Šé™)
        - ğŸš€ æ¿€è¿›å‹ (95%ä¸Šé™)
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - currentAge
                - annualSalary
              properties:
                currentAge:
                  type: integer
                  example: 35
                annualSalary:
                  type: number
                  example: 150000
                currentContribution:
                  type: number
                  description: å½“å‰ç¼´è´¹é¢ (å¯é€‰)
                  example: 8000
                t2Rate:
                  type: number
                  description: T2ç‡ (å¯é€‰)
                  example: 10.0
                wageGrowthRate:
                  type: number
                  description: å·¥èµ„å¢é•¿ç‡ (å¯é€‰,é»˜è®¤3.5%)
                  example: 4.0
      responses:
        '200':
          description: ç”ŸæˆæˆåŠŸ
          content:
            application/json:
              schema:
                type: object
                properties:
                  tiers:
                    type: array
                    minItems: 5
                    maxItems: 5
                    items:
                      type: object
                      properties:
                        tier:
                          type: string
                          example: "balanced"
                        name:
                          type: string
                          example: "å‡è¡¡å‹"
                        icon:
                          type: string
                          example: "âš–ï¸"
                        contribution:
                          type: number
                          example: 8400
                        capUtilization:
                          type: number
                          description: ä¸Šé™åˆ©ç”¨ç‡ (%)
                          example: 70
                        cap_utilization:
                          type: number
                          example: 70
                        npv:
                          type: object
                          properties:
                            total_npv:
                              type: number
                              example: 19702.16
                            years_to_retirement:
                              type: integer
                              example: 25
                        characteristics:
                          type: array
                          items:
                            type: string
                        suitableFor:
                          type: string
                        suitable_for:
                          type: string
                        riskLevel:
                          type: string
                          example: "ä¸­"
                        risk_level:
                          type: string
                          example: "ä¸­"
                        annualBenefit:
                          type: number
                        annual_benefit:
                          type: number
                  recommended:
                    type: string
                    example: "balanced"

components:
  schemas:
    Error:
      type: object
      properties:
        error:
          type: string
          description: é”™è¯¯æ¶ˆæ¯
          example: "ç¼ºå°‘å¿…å¡«å­—æ®µ: age"
        
  securitySchemes:
    ApiKeyAuth:
      type: apiKey
      in: header
      name: X-API-Key
      description: APIå¯†é’¥è®¤è¯ (æœªæ¥ç‰ˆæœ¬)

security: []
