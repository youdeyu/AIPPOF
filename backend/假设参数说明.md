# 📊 AIPPOF系统假设参数完整说明

## 一、用户输入数据（测试案例）

### 1.1 基本信息
```python
current_age = 27              # 当前年龄（岁）
current_salary = 80000        # 当前年薪（元）
行业 = "金融"                  # 行业（用于展示，不影响计算）
职级 = "初级"                  # 职级（用于展示，不影响计算）
```

### 1.2 历史缴费记录
```python
history_data = [
    {"year": 2022, "salary": 66000, "contribution": 5000},
    {"year": 2023, "salary": 72000, "contribution": 5000},
    {"year": 2024, "salary": 80000, "contribution": 6000}
]
```

---

## 二、T2计算假设参数

### 2.1 个税起征点和税率表
**文件**: `api/t2_calculator.py`

```python
# 个税起征点
EXEMPTION = 60000  # 年度免征额：60,000元（月均5,000元）

# 综合所得税率表（7档累进）
TAX_BRACKETS = [
    (0, 36000, 0.03),          # 0-36k: 3%
    (36000, 144000, 0.10),     # 36k-144k: 10%
    (144000, 300000, 0.20),    # 144k-300k: 20%
    (300000, 420000, 0.25),    # 300k-420k: 25%
    (420000, 660000, 0.30),    # 420k-660k: 30%
    (660000, 960000, 0.35),    # 660k-960k: 35%
    (960000, float('inf'), 0.45)  # 960k+: 45%
]
```

### 2.2 蓝浩歌T2公式
```
T2 = (实际税收节约 / 缴费额) × 100%

实际税收节约 = 税前税负 - 税后税负
税前税负 = calculate_tax(年薪)
税后税负 = calculate_tax(年薪 - 个人养老金缴费)
```

**示例计算（2024年）**:
- 年薪: ¥80,000
- 缴费: ¥6,000
- 税前税负: calculate_tax(80000 - 60000) = ¥600
- 税后税负: calculate_tax(80000 - 6000 - 60000) = ¥420
- 节税: ¥600 - ¥420 = ¥180
- **T2 = 180 / 6000 = 3.00%**

---

## 三、动态上限假设参数（Formula 5-5）

### 3.1 上限计算公式
**文件**: `api/cap_calculator.py`

```python
C_final(w, t₂) = min(C_dynamic, C_fixed_effective)

# 1. 动态上限
C_dynamic = 0.08 × w  # 8%工资比例

# 2. 固定上限（S型平滑）
C_fixed_smooth(t₂) = base + Σ[Δᵢ × σ(k×(t₂ - thr_i))]

nodes = (12000, 24000, 48000, 72000)  # 四档固定上限
thresholds = (0.03, 0.05, 0.10)       # T2阈值：3%, 5%, 10%
k = 20.0                               # S型函数斜率

# 3. 高收入递减因子
τ(w) = τ_min + (1 - τ_min) × (1 - σ((w - w0)/b))

tau_min = 0.5           # 最低折扣（递减50%）
w0_pivot = 200000       # 收入递减起点：20万元
b_width = 100000        # 递减平滑宽度：10万元

# 4. 有效固定上限
C_fixed_effective = C_fixed_smooth(t₂) × τ(w)
```

**测试案例计算（年薪¥80,000, T2=3.00%）**:
- C_dynamic = 80000 × 8% = **¥6,400**
- C_fixed_smooth = 32,379元（基于T2=3%的S型函数）
- τ(w) = 0.8840（80k << 200k拐点，轻微递减）
- C_fixed_effective = 32,379 × 0.8840 = ¥28,632
- **最终上限 = min(6400, 28,632) = ¥6,400** （选用动态通道）

---

## 四、T3计算假设参数

### 4.1 双Logistic函数参数
**文件**: `api/t3_calculator.py`

```python
# 基础参数
L1 = 0.0          # 最低税率（0%）
L2 = 7.0          # 中档税率（7%）
L3 = 7.0          # 高收入附加税率（7%）
T2_mid = 5.0      # T2中值（5%）
w_high = 500000   # 高收入阈值（50万元）
k1 = 2.0          # T2敏感度系数
k2 = 0.00001      # 收入敏感度系数（非常小，曲线平缓）

# 双Logistic公式
t3 = L1 + (L2-L1)/(1+e^(-k1*(T2-T2_mid))) + L3/(1+e^(-k2*(w-w_high)))

# 年龄调整（55岁及以上）
if age >= 55:
    age_discount = (60 - age) × 0.02  # 每年降低0.02%
    t3 = max(0, t3 - age_discount)
```

**测试案例计算（T2=3%, 年薪¥80,000, 27岁）**:
- 基础税率: 0.13%（基于T2=3% < T2_mid=5%）
- 收入调整: 0.10%（基于80k << 500k）
- 年龄折扣: 0.00%（27岁 < 55岁）
- **最终T3 = 0.23%**

---

## 五、补贴计算假设参数

### 5.1 渐进式精准补贴参数
**文件**: `api/subsidy_calculator.py`

```python
# 基础参数
base_grant = 150.0              # 固定补贴（元）
c_min = 200.0                   # 最低缴费额（元）
c0_ratio_of_wage = 0.02         # 第一档缴费基数比例（2%工资）

# 匹配比例（两档）
ratio_low = 0.30                # 低档匹配率（首档缴费30%）
ratio_high = 0.06               # 高档匹配率（超额缴费6%）

# 低收入倾斜
uplift_low = 0.5                # 低收入加成比例（首档配比+50%）
low_income_cut = 80000.0        # 低收入界定标准（≤8万元/年）

# 补贴递减（平滑过渡）
taper_mode = True               # 启用收入递减
taper_w_low = 40000.0           # 全额补贴上限（≤4万元全额）
taper_w_high = 100000.0         # 补贴归零下限（≥10万元归零）
```

### 5.2 补贴计算公式
```python
# 1. 计算首档缴费基数
c0 = max(c_min, annual_salary × c0_ratio_of_wage)

# 2. 配比补贴
if contribution_amount <= c0:
    match_subsidy = contribution_amount × ratio_low
else:
    match_subsidy = c0 × ratio_low + (contribution_amount - c0) × ratio_high

# 3. 低收入加成
if annual_salary <= low_income_cut:
    tier1 = min(contribution_amount, c0)
    low_income_boost = tier1 × ratio_low × uplift_low
    match_subsidy += low_income_boost

# 4. 收入递减因子
if annual_salary <= taper_w_low:
    taper_factor = 1.0  # 全额补贴
elif annual_salary >= taper_w_high:
    taper_factor = 0.0  # 补贴归零
else:
    taper_factor = (taper_w_high - annual_salary) / (taper_w_high - taper_w_low)

# 5. 总补贴
total_subsidy = (base_grant + match_subsidy) × taper_factor
```

**测试案例计算（2024年：年薪¥80,000, 缴费¥6,000）**:
- c0 = max(200, 80000 × 2%) = ¥1,600
- 配比补贴 = 1600 × 30% + (6000-1600) × 6% = 480 + 264 = ¥744
- 低收入加成 = 1600 × 30% × 50% = ¥240（年薪80k ≤ 界定线80k）
- match_subsidy = 744 + 240 = ¥984
- taper_factor = (100000-80000)/(100000-40000) = 0.333
- **总补贴 = (150 + 984) × 0.333 = ¥378.00**

---

## 六、NPV计算假设参数

### 6.1 五档方案设定
**文件**: `api/contribution_suggestions.py`

```python
# 五档方案上限利用率
conservative_tier = 0.30    # 保守型：30%上限
stable_tier = 0.50          # 稳健型：50%上限
balanced_tier = 0.70        # 均衡型：70%上限（推荐）
aggressive_tier = 0.85      # 积极型：85%上限
maximum_tier = 0.95         # 激进型：95%上限
```

### 6.2 NPV计算假设
```python
# 宏观经济参数
wage_growth_rate = 3.5      # 工资年增长率（3.5%）
discount_rate = 3.0         # 折现率（3.0%）
retirement_age = 60         # 退休年龄（60岁）

# NPV计算公式
years_to_retirement = retirement_age - current_age

# 缴费期NPV（当前到退休）
for year in range(1, years_to_retirement + 1):
    # 工资增长
    salary = current_salary × (1 + wage_growth_rate/100) ^ year
    
    # 年度收益 = 补贴 + 节税
    annual_benefit = subsidy + tax_save
    
    # 折现
    discount_factor = (1 + discount_rate/100) ^ year
    pv = annual_benefit / discount_factor
    contribution_npv += pv

# 领取期NPV（退休后20年）
withdrawal_years = 20
for year in range(1, withdrawal_years + 1):
    # 年度成本 = T3税负
    tax_cost = accumulated_amount × t3_rate / 100 / withdrawal_years
    
    # 折现
    discount_factor = (1 + discount_rate/100) ^ (years_to_retirement + year)
    pv = -tax_cost / discount_factor
    withdrawal_npv += pv

# 总NPV
total_npv = contribution_npv + withdrawal_npv
```

**测试案例计算（方案3均衡型：¥4,480）**:
- 缴费年限: 60 - 27 = 33年
- 年均工资增长: 3.5%
- 年均收益折现: 基于3%折现率
- **全周期总NPV = ¥3,871**
- **年均收益 = 3871 / 33 = ¥117**

---

## 七、其他隐含假设

### 7.1 生命周期假设
```python
工作年龄段 = 22岁 ~ 60岁
退休年龄 = 60岁（法定退休）
领取期限 = 20年（60岁 ~ 80岁）
存活假设 = 80岁
```

### 7.2 政策稳定性假设
- 个税税率表保持不变
- 补贴政策持续执行
- 动态上限公式不变
- T3税率公式不变

### 7.3 投资收益假设
- **未显式建模投资收益**
- 假设账户增值由个人选择（不纳入NPV计算）
- 仅计算政策性收益（补贴+节税-T3税负）

### 7.4 通货膨胀处理
- 使用名义值计算
- 工资增长率3.5%已隐含通胀
- 折现率3.0%接近实际利率

---

## 八、关键假设总结表

| 参数类别 | 参数名称 | 假设值 | 来源/依据 |
|---------|---------|--------|-----------|
| **个税** | 起征点 | ¥60,000/年 | 现行个税法 |
| **个税** | 最高税率 | 45% | 7档累进税率 |
| **T2** | 计算方式 | 蓝浩歌公式 | 论文方法 |
| **上限** | 动态比例 | 8% | Formula 5-5 |
| **上限** | 固定档位 | 12k/24k/48k/72k | 分层设计 |
| **上限** | 高收入拐点 | ¥200,000 | 递减起点 |
| **T3** | 基础税率范围 | 0%-7% | 双Logistic |
| **T3** | T2中值 | 5% | 敏感度设定 |
| **T3** | 高收入阈值 | ¥500,000 | 收入影响线 |
| **补贴** | 固定补贴 | ¥150 | 政策参数 |
| **补贴** | 低档配比 | 30% | 激励参数 |
| **补贴** | 高档配比 | 6% | 激励参数 |
| **补贴** | 低收入界定 | ¥80,000 | 倾斜标准 |
| **补贴** | 递减区间 | 4万~10万 | 平滑过渡 |
| **NPV** | 工资增长率 | 3.5% | 宏观预测 |
| **NPV** | 折现率 | 3.0% | 时间价值 |
| **NPV** | 退休年龄 | 60岁 | 法定标准 |
| **NPV** | 领取期限 | 20年 | 寿命假设 |

---

## 九、敏感性说明

### 9.1 对结果影响最大的参数（由高到低）
1. **工资增长率** (wage_growth_rate)
   - 默认3.5% → 改为5%: NPV提升约30%
   
2. **折现率** (discount_rate)
   - 默认3.0% → 改为5%: NPV下降约20%
   
3. **T2阈值** (T2_mid in T3计算)
   - 影响领取期税负
   
4. **补贴递减区间** (taper_w_low/high)
   - 影响中等收入群体补贴额

### 9.2 对结果影响较小的参数
- T3收入敏感度 k2 (默认0.00001，曲线已极度平缓)
- 高收入递减宽度 b_width
- 补贴固定部分 base_grant

---

## 十、测试案例完整参数清单

```python
# === 用户输入 ===
age = 27
current_salary = 80000
history = [
    (2022, 66000, 5000),
    (2023, 72000, 5000),
    (2024, 80000, 6000)
]

# === 计算参数 ===
个税起征点 = 60000
T2公式 = "蓝浩歌"
累积T2 = 3.00%
动态上限比例 = 8%
动态上限 = 6400
T3双Logistic = (L1=0, L2=7, L3=7, T2_mid=5, w_high=500k)
T3 = 0.23%

补贴固定 = 150
补贴低档配比 = 30%
补贴高档配比 = 6%
低收入加成 = 50%
低收入界定 = 80000
递减区间 = (40000, 100000)

工资增长率 = 3.5%
折现率 = 3.0%
退休年龄 = 60
领取期 = 20年

# === 五档方案 ===
保守型 = 30%上限 = 1920元 → NPV = 2096
稳健型 = 50%上限 = 3200元 → NPV = 2984
均衡型 = 70%上限 = 4480元 → NPV = 3871 ⭐推荐
积极型 = 85%上限 = 5440元 → NPV = 4536
激进型 = 95%上限 = 6080元 → NPV = 4980
```

---

**文档更新日期**: 2025年11月3日  
**版本**: v1.0  
**适用系统**: AIPPOF个人养老金优化框架网页应用
